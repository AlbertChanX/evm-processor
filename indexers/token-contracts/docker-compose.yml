version: '3'

networks:
  host:
    external: true
    driver: bridge

services:
  migrate:
    build:
      context: ../../.
      target: archiver
      dockerfile: Dockerfile
      args:
        - BUILD_CONTEXT=indexers/token-contracts
    environment:
      - DB_NAME
      - DB_HOST
      - DB_PORT
  indexer:
    build:
      context: ../../.
      target: archiver
      dockerfile: Dockerfile
      args:
        - BUILD_CONTEXT=indexers/token-contracts
    restart: unless-stopped
    environment:
      - ARCHIVE_GRAPH
      - DB_NAME
      - DB_HOST
      - DB_PORT
  index-query-node:
    build:
      context: ../../.
      target: queryNode
      dockerfile: Dockerfile
      args:
        - BUILD_CONTEXT=indexers/token-contracts
    restart: unless-stopped
    ports:
      - 80:80
    environment:
      - DB_NAME
      - DB_HOST
      - DB_PORT
